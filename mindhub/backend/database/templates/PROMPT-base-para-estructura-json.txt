## OBJETIVO
Extraer y estructurar escalas cl√≠nicas en 2 documentos: formato JSON universal y otro .MD 
Para que estos documentos sean compatibles con cualquier tipo de escala y l√≥gica de respuestas.

## FORMATO DE SALIDA REQUERIDO
Generar JSON v√°lido siguiendo EXACTAMENTE la estructura se√±alada y otro documento (de la misma escala) con estructura .MD definida a continuaci√≥n. 

Las escalas clinim√©tricas son estandarizadas, por lo que el formato de los √≠tems debe ser exacto acorde a la literatura cient√≠fica actualizada. Para idioma espa√±ol castellano o espa√±ol latinoamericano, si se encuentran datos o evidencia cient√≠fica espec√≠ficamente para M√©xico mejor. 

Las indicaciones de como realizar las escalas, tienen que dividirse en 2, donde una indicaci√≥n es de como aplicar la escala o instrumento, que esto ser√° las instrucciones al profesional ("instructions_professional") esta debe ser con lenguaje profesional, se√±alando las mejores practicas para la administraci√≥n del instrumento, evitando utilizar puntos de corte ya que estos se generan autom√°ticamente por el sistema, y dando as√≠ bien tipo entrenamiento resumido de las mejores practicas para la administraci√≥n de la escala en cuesti√≥n. Y la otra parte ser√°n indicaciones para el paciente ("instructions_patient"), que ser√°n en un lenguaje NO tecnico, que viene espec√≠ficamente en cada escala (cuando son Autoadministradas o se pueden realizar de ambas formas ("both"), si es una escala Heteroaplicada o "clinician_administered" no llevan instrucciones para el paciente. Evita usar frases como ¬®marca con una cruz¬®o cosas similares, ya que la escala es de selecci√≥n o de anotar, mediante medios electr√≥nicos, por lo que sera solo seleccionar. 

**SIEMPRE USA snake_case como lenguaje informativo.**

### Proceso de Investigaci√≥n
1. **Analizar documentos proporcionados** (si se incluyen archivos o im√°genes)
2. **Buscar informaci√≥n cient√≠fica validada en:**
   - PubMed y bases de datos acad√©micas
   - Sitios oficiales de las escalas
   - Manuales cl√≠nicos publicados
   - Art√≠culos con factor de impacto
   - Solo fuentes con referencias bibliogr√°ficas verificables

3. **Extraer informaci√≥n completa:**
   - TODOS los √≠tems/preguntas exactas
   - Opciones de respuesta con sus valores num√©ricos
   - Sistema de puntuaci√≥n y c√°lculo
   - Rangos de interpretaci√≥n cl√≠nica
   - Subescalas si existen
   - Propiedades psicom√©tricas (Œ± de Cronbach, etc.)

## REGLAS CR√çTICAS PARA EVITAR ERRORES DE IMPORTACI√ìN

### 1. **IDs √öNICOS OBLIGATORIOS**
- **JAM√ÅS** uses el mismo ID en diferentes secciones
- `response_options[].id` debe ser diferente de `response_groups[].options[].id`
- Si hay opciones globales Y opciones en grupos, usa prefijos diferentes:
  - Opciones globales: `[scale-id]-opt-[n]`
  - Opciones de grupo: `[scale-id]-grp-[group-index]-opt-[n]`

### 2. **NUMERACI√ìN DE √çTEMS CONSECUTIVA**
- Cada √≠tem debe tener un `number` √∫nico y consecutivo
- Si un formulario tiene √≠tems como "7a, 7b, 7c, 7d", asigna n√∫meros 7, 8, 9, 10
- Conserva el c√≥digo original en el campo `code` si es necesario
- Actualiza las referencias en `subscales[].items` para usar los nuevos n√∫meros

### 3. **SISTEMA DE RESPUESTAS - USAR SOLO UNO**
Basado en el an√°lisis de 21 escalas cl√≠nicas, estos son los patrones m√°s comunes:

**OPCI√ìN A: Response Options Globales (40% de las escalas)**
Usar cuando TODOS los √≠tems comparten exactamente las mismas opciones de respuesta.
Ejemplos: STAI, AQ, Plutchik, escalas Likert simples.
```json
{
  "response_options": [
    {"id": "scale-opt-0", "value": "0", "label": "No", "score": 0, "order_index": 1}
  ],
  "response_groups": [],
  "items": [
    {"response_group": null, "specific_options": []}
  ]
}
```

**OPCI√ìN B: Response Groups (35% de las escalas)**
Usar cuando hay grupos de √≠tems con diferentes tipos de respuesta.
Ejemplos: BITE, IIEF-15, MOS-Sleep, escalas mixtas con secciones binarias y de frecuencia.
```json
{
  "response_options": [],
  "response_groups": [
    {
      "id": "scale-group-1",
      "key": "binary_response",
      "name": "Respuesta Binaria",
      "options": [
        {"id": "scale-grp-1-opt-0", "value": "0", "label": "No", "score": 0, "order_index": 1}
      ]
    }
  ],
  "items": [
    {"response_group": "binary_response", "specific_options": []}
  ]
}
```

**OPCI√ìN C: Specific Options (25% de las escalas)**
Usar cuando cada √≠tem tiene opciones completamente √∫nicas.
Ejemplos: BDI-21, BDI-13, escalas donde cada pregunta tiene su propia redacci√≥n de opciones.
```json
{
  "response_options": [],
  "response_groups": [],
  "items": [
    {
      "response_group": null,
      "specific_options": [
        {"id": "scale-item-1-opt-0", "value": "0", "label": "Opci√≥n √∫nica", "score": 0, "order_index": 1}
      ]
    }
  ]
}
```

### 4. **QUESTION_TYPE RECOMENDADOS**
- `"likert"` - **USAR PARA EL 90% DE CASOS** (incluso binarias S√≠/No)
- `"multiple_choice"` - Solo si las opciones NO tienen orden l√≥gico
- `"numeric"` - Solo para entrada num√©rica libre (edad, horas, etc.)
- `"text"` - Solo para respuestas abiertas de texto

### 5. **CATEGOR√çAS ESTANDARIZADAS**
Usar siempre en espa√±ol, en min√∫sculas:
- `"autismo"` - TEA y trastornos relacionados
- `"ansiedad"` - Trastornos de ansiedad (NO usar "anxiety")
- `"depresion"` - Trastornos depresivos (sin tilde)
- `"adicciones"` - Trastornos por uso de sustancias
- `"personalidad"` - Trastornos de personalidad
- `"cognitivo"` - TDAH, d√©ficit cognitivos
- `"psicosis"` - Trastornos psic√≥ticos
- `"trastornos_alimentarios"` - Anorexia, bulimia, etc.
- `"general"` - Escalas multidimensionales o generales

## ESTRUCTURA JSON REQUERIDA (v2.0 - Mejorada)

```json
{
  "scale": {
    "id": "string - identificador √∫nico en min√∫sculas con guiones (ej: bite, ipde-cie10)",
    "name": "string - nombre completo oficial de la escala",
    "abbreviation": "string - siglas o acr√≥nimo oficial",
    "description": "string - descripci√≥n detallada del prop√≥sito y uso de la escala",
    "version": "string - versi√≥n de la escala",
    "category": "string - categor√≠a en espa√±ol de la lista estandarizada",
    "subcategory": "string - subcategor√≠a espec√≠fica o null",
    "author": "string - autores principales de la escala",
    "publication_year": "integer - a√±o de publicaci√≥n original",
    "total_items": "integer - n√∫mero total de √≠tems/preguntas",
    "estimated_duration_minutes": "integer - tiempo estimado de aplicaci√≥n en minutos",
    "administration_mode": "string - uno de: self_administered, clinician_administered, both",
    "target_population": "string - poblaci√≥n objetivo detallada incluyendo edad, condiciones, contexto",
    "scoring_method": "string - uno de: sum, sum_by_subscale, weighted_sum, average, categorical, algorithm",
    "score_range_min": "integer - puntuaci√≥n m√≠nima posible",
    "score_range_max": "integer - puntuaci√≥n m√°xima posible",
    "instructions_professional": "string - instrucciones completas para el profesional que administra la escala",
    "instructions_patient": "string - instrucciones completas para el paciente/evaluado o null si es heteroaplicada",
    
    // NUEVOS CAMPOS OPCIONALES PARA METADATOS
    "who_completes": "string - opcional: self/parent/teacher/clinician/multiple",
    "requires_interview": "boolean - opcional: true si requiere entrevista estructurada",
    "cultural_adaptation": "string - opcional: mexico/spain/universal",
    "diagnostic_system": "string - opcional: dsm-5/cie-10/dsm-iv/cie-11"
  },

  "response_options": [
    // SOLO usar si la escala tiene opciones GLOBALES para todos los √≠tems
    // Si usas response_groups o specific_options, este array debe estar VAC√çO []
    {
      "id": "string - formato: [scale-id]-opt-[n] (ej: bite-opt-0)",
      "value": "string - valor de la opci√≥n",
      "label": "string - texto que ve el usuario (con emojis si ayudan: ‚ùå‚úÖ)",
      "score": "integer - puntuaci√≥n num√©rica",
      "order_index": "integer - orden de presentaci√≥n"
    }
  ],

  "response_groups": [
    // SOLO usar si la escala tiene DIFERENTES TIPOS de respuesta para distintos √≠tems
    // Si usas response_options globales o solo specific_options, este array debe estar VAC√çO []
    {
      "id": "string - identificador √∫nico del grupo (ej: bite-group-binary)",
      "key": "string - clave del grupo en snake_case (ej: binary_response)",
      "name": "string - nombre descriptivo del grupo",
      "description": "string - descripci√≥n del grupo o null",
      "display_order": "integer - orden de presentaci√≥n",
      "display_type": "string - opcional: horizontal/vertical/grid",
      "options": [
        {
          "id": "string - formato: [scale-id]-grp-[n]-opt-[n] (ej: bite-grp-1-opt-0)",
          "value": "string - valor de la opci√≥n",
          "label": "string - texto de la opci√≥n",
          "score": "integer - puntuaci√≥n",
          "order_index": "integer - orden"
        }
      ]
    }
  ],

  "items": [
    {
      "id": "string - formato: [scale-id]-item-[n] (ej: bite-item-1)",
      "number": "integer - n√∫mero √öNICO y CONSECUTIVO del √≠tem (1, 2, 3, 4, NO 1, 2, 2, 2)",
      "text": "string - texto completo del √≠tem/pregunta EXACTO de la literatura",
      "code": "string - c√≥digo original del √≠tem (ej: 7a, 7b) o null",
      "question_type": "string - uno de: likert, multiple_choice, numeric, text",
      "response_group": "string - key del grupo de respuesta o null si usa response_options globales",
      "reverse_scored": "boolean - true si se punt√∫a inversamente",
      "alert_trigger": "boolean - true si puede generar alerta cl√≠nica",
      "alert_condition": "string - condici√≥n para la alerta o null",
      "help_text": "string - texto de ayuda adicional o null",
      "required": "boolean - true si es obligatorio",
      
      // NUEVOS CAMPOS OPCIONALES
      "depends_on": "object - opcional: {item_number: X, condition: 'equals', value: Y}",
      "validation_rule": "string - opcional: regla de validaci√≥n espec√≠fica",
      "display_condition": "string - opcional: condici√≥n para mostrar el √≠tem",
      
      "specific_options": [
        // SOLO usar si este √≠tem espec√≠fico tiene opciones √∫nicas
        // Si el √≠tem usa response_group o response_options globales, este array debe estar VAC√çO []
        {
          "id": "string - formato: [scale-id]-item-[n]-opt-[n] (ej: bite-item-1-opt-0)",
          "value": "string - valor",
          "label": "string - texto de la opci√≥n",
          "score": "integer - puntuaci√≥n",
          "order_index": "integer - orden"
        }
      ]
    }
  ],

  "subscales": [
    {
      "id": "string - identificador √∫nico",
      "name": "string - nombre de la subescala",
      "code": "string - c√≥digo de la subescala o null",
      "items": "array - n√∫meros de √≠tems que componen la subescala (usar los n√∫meros finales, no los c√≥digos)",
      "min_score": "integer - puntuaci√≥n m√≠nima",
      "max_score": "integer - puntuaci√≥n m√°xima",
      "description": "string - descripci√≥n de lo que mide o null",
      
      // NUEVO CAMPO OPCIONAL
      "scoring_direction": "string - opcional: normal/reverse/mixed"
    }
  ],

  "interpretation_rules": [
    {
      "id": "string - identificador √∫nico",
      "min_score": "integer - puntuaci√≥n m√≠nima del rango",
      "max_score": "integer - puntuaci√≥n m√°xima del rango",
      "severity_level": "string - uno de: minimal, mild, moderate, severe, very_severe, clinical, subclinical, at_risk",
      "label": "string - etiqueta descriptiva del rango",
      "color": "string - c√≥digo de color hexadecimal o null",
      "description": "string - descripci√≥n detallada o null",
      "recommendations": "string - recomendaciones cl√≠nicas o null",
      
      // NUEVOS CAMPOS OPCIONALES
      "applies_to": "string - opcional: total/subscale_name para reglas espec√≠ficas",
      "percentile_range": "string - opcional: rango percentil (ej: 75-90)"
    }
  ],

  "documentation": {
    "bibliography": "string - referencias bibliogr√°ficas principales",
    "sources_consulted": "array - lista de fuentes consultadas",
    "implementation_notes": "string - notas sobre la implementaci√≥n",
    "psychometric_properties": {
      "reliability": "string - informaci√≥n sobre confiabilidad",
      "validity": "string - informaci√≥n sobre validez",
      "sensitivity": "string - sensibilidad o null",
      "specificity": "string - especificidad o null",
      
      // NUEVOS CAMPOS OPCIONALES
      "cronbach_alpha": "string - opcional: valor del Œ± de Cronbach",
      "test_retest": "string - opcional: confiabilidad test-retest",
      "factor_structure": "string - opcional: estructura factorial"
    },
    "clinical_considerations": "string - consideraciones cl√≠nicas importantes",
    "special_items_notes": "object - notas sobre √≠tems espec√≠ficos o null",
    "version_notes": "string - notas sobre esta versi√≥n",
    "target_population_details": "string - detalles adicionales sobre poblaci√≥n",
    "clinical_interpretation": "string - gu√≠a de interpretaci√≥n cl√≠nica",
    
    // NUEVOS CAMPOS OPCIONALES
    "cultural_considerations": "string - opcional: consideraciones culturales espec√≠ficas",
    "training_requirements": "string - opcional: requisitos de entrenamiento para administrar",
    "copyright_notice": "string - opcional: informaci√≥n de copyright"
  }
}
```

## PATRONES COMUNES IDENTIFICADOS (Basado en 21 escalas)

### 1. **Escalas Binarias Simples (15%)**
- IPDE, partes de BITE
- Usar response_options globales con 2 opciones
- question_type: "likert" (NO "binary")

### 2. **Escalas Likert Est√°ndar (40%)**
- STAI, AQ, Plutchik, GADI
- 4-5 opciones ordenadas de frecuencia/acuerdo
- Usar response_options globales

### 3. **Escalas con Opciones Espec√≠ficas por √çtem (25%)**
- BDI-21, BDI-13
- Cada √≠tem tiene redacci√≥n √∫nica de opciones
- Usar specific_options en cada √≠tem

### 4. **Escalas Mixtas con Grupos (20%)**
- BITE, IIEF-15, MOS-Sleep
- Diferentes secciones con diferentes tipos de respuesta
- Usar response_groups

### 5. **Escalas con √çtems Condicionales**
- Algunos √≠tems solo aparecen seg√∫n respuestas previas
- Usar campo "depends_on" (nuevo)

## DOCUMENTO MD COMPLEMENTARIO

**[nombre-escala]-docs.md**

```markdown
# [Nombre Completo de la Escala] - Documentaci√≥n Cient√≠fica

## Informaci√≥n General
- **Nombre completo**: [Nombre oficial]
- **Abreviatura**: [Siglas]
- **Autores**: [Autores principales]
- **A√±o de publicaci√≥n**: [A√±o]
- **Versi√≥n documentada**: [Versi√≥n]

## Descripci√≥n
[Descripci√≥n detallada del instrumento, su prop√≥sito y aplicaciones cl√≠nicas]

## Poblaci√≥n Objetivo
[Descripci√≥n detallada de la poblaci√≥n para la cual est√° validada]

## Estructura del Instrumento
- **N√∫mero de √≠tems**: [N]
- **Subescalas**: [Lista de subescalas si aplica]
- **Tiempo de aplicaci√≥n**: [Minutos estimados]
- **Modo de administraci√≥n**: [Auto/hetero/ambas]

## Sistema de Puntuaci√≥n
[Descripci√≥n detallada del sistema de puntuaci√≥n]

### C√°lculo de Puntuaciones
[F√≥rmulas o procedimientos espec√≠ficos]

### Interpretaci√≥n de Resultados
[Rangos de puntuaci√≥n y su significado cl√≠nico]

## Propiedades Psicom√©tricas

### Confiabilidad
- **Consistencia interna (Œ± de Cronbach)**: [Valor]
- **Test-retest**: [Valor si disponible]
- **Confiabilidad inter-evaluador**: [Si aplica]

### Validez
- **Validez de constructo**: [Descripci√≥n]
- **Validez de criterio**: [Descripci√≥n]
- **Validez convergente/divergente**: [Si disponible]

### Sensibilidad y Especificidad
[Valores si est√°n disponibles]

## Adaptaciones y Versiones

### Adaptaci√≥n para M√©xico/Latinoam√©rica
[Informaci√≥n sobre adaptaciones culturales si existen]

### Otras Versiones
[Versiones abreviadas, extendidas, para diferentes poblaciones]

## Consideraciones Cl√≠nicas

### Ventajas
- [Lista de ventajas del instrumento]

### Limitaciones
- [Lista de limitaciones conocidas]

### Recomendaciones de Uso
[Cu√°ndo usar y cu√°ndo no usar el instrumento]

## Consideraciones √âticas
[Aspectos √©ticos relevantes en la aplicaci√≥n]

## Referencias Bibliogr√°ficas

### Art√≠culo Original
[Referencia completa en formato APA]

### Validaciones en Poblaci√≥n Hispanohablante
[Referencias de estudios de validaci√≥n]

### Otros Estudios Relevantes
[Referencias adicionales importantes]

## Notas de Implementaci√≥n
[Cualquier nota espec√≠fica sobre la implementaci√≥n digital de la escala]

## Recursos Adicionales
- [Enlaces a manuales oficiales]
- [Sitios web de referencia]
- [Materiales de entrenamiento]

---
*√öltima actualizaci√≥n: [Fecha]*
*Versi√≥n del documento: 1.0*
```

## VALIDACI√ìN FINAL ANTES DE ENTREGAR

1. ‚úÖ **IDs √∫nicos**: Ning√∫n ID se repite en todo el JSON
2. ‚úÖ **Numeraci√≥n consecutiva**: items[].number son 1, 2, 3, 4... sin repetir
3. ‚úÖ **Sistema de respuestas consistente**: Solo un m√©todo usado por escala
4. ‚úÖ **Referencias v√°lidas**: response_group apunta a keys existentes
5. ‚úÖ **Subscales actualizadas**: items[] usa n√∫meros finales, no c√≥digos originales
6. ‚úÖ **snake_case**: Todos los campos usan formato correcto
7. ‚úÖ **Categor√≠as en espa√±ol**: Usar lista estandarizada, no mezclar idiomas
8. ‚úÖ **JSON v√°lido**: Sintaxis correcta sin errores de comas o llaves
9. ‚úÖ **Documentaci√≥n MD**: Archivo complementario con informaci√≥n cient√≠fica completa

## TIPS BASADOS EN EXPERIENCIA

1. **Para escalas tipo BDI**: Usar specific_options, cada √≠tem tiene opciones √∫nicas
2. **Para escalas tipo STAI/AQ**: Usar response_options globales
3. **Para escalas tipo BITE/IIEF**: Usar response_groups para diferentes secciones
4. **Emojis √∫tiles**: ‚ùå ‚úÖ ‚ö†Ô∏è üî¥ üü° üü¢ pueden mejorar la claridad visual
5. **Help text**: Usar para aclarar t√©rminos t√©cnicos o dar ejemplos
6. **√çtems inversos**: Marcar claramente con reverse_scored: true
7. **Alertas cl√≠nicas**: Usar alert_trigger para √≠tems de riesgo (suicidio, autolesi√≥n)